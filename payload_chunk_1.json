[{"path": "flet_login_manager.py", "content": "\"\"\"\nFlet-compatible LoginManager\nå°† PyQt Signal æœºåˆ¶æ”¹ä¸ºå›è°ƒå‡½æ•°,ä»¥ä¾¿åœ¨ Flet ä¸­ä½¿ç”¨\n\"\"\"\nimport asyncio\nimport aiohttp\nfrom typing import List, Dict, Callable, Optional\n\n# ============================================================================\n# é…ç½®å¸¸é‡ (ä» openwrt_manager.py å¤åˆ¶)\n# ============================================================================\n\nCREDENTIALS_LIST = [\n    {\"username\": \"root\", \"password\": \"password\"},  # é»˜è®¤ä¼˜å…ˆ\n    {\"username\": \"root\", \"password\": \"admin\"},\n    {\"username\": \"admin\", \"password\": \"admin\"},\n    {\"username\": \"ubnt\", \"password\": \"ubnt\"},\n    {\"username\": \"root\", \"password\": \"123456\"},\n]\n\nLOGIN_PATHS = [\n    \"/cgi-bin/luci\",           # æ ‡å‡† LuCI (OpenWrt å®˜æ–¹)\n    \"/cgi-bin/luci/admin\",     # éƒ¨åˆ†å®šåˆ¶ç‰ˆæœ¬\n    \"/login\",                  # ç®€åŒ–è·¯å¾„\n]\n\nFIELD_NAME_VARIANTS = [\n    {\"username\": \"luci_username\", \"password\": \"luci_password\"},  # æ ‡å‡† LuCI\n    {\"username\": \"username\", \"password\": \"password\"},            # ç®€åŒ–ç‰ˆ\n    {\"username\": \"auth_username\", \"password\": \"auth_password\"},  # è®¤è¯ç‰ˆ\n]\n\n\nclass FletLoginManager:\n    \"\"\"Flet å…¼å®¹çš„ç™»å½•ç®¡ç†å™¨\"\"\"\n    \n    def __init__(self, max_concurrent: int = 50):\n        self.max_concurrent = max_concurrent\n        self.semaphore = asyncio.Semaphore(max_concurrent)\n        self._tasks = []\n        self._is_running = False\n        \n        # å›è°ƒå‡½æ•° (æ›¿ä»£ PyQt Signal)\n        self.on_row_update: Optional[Callable] = None  # (row, status, user, pwd, notes)\n        self.on_task_finished: Optional[Callable] = None  # ()\n    \n    async def detect_login(self, row: int, target_url: str) -> Dict:\n        \"\"\"\n        æ¢æµ‹å•ä¸ª OpenWrt è®¾å¤‡çš„ç™»å½•\n        \n        Args:\n            row: è¡¨æ ¼è¡Œå·\n            target_url: ç›®æ ‡ URL\n            \n        Returns:\n            æ£€æµ‹ç»“æœå­—å…¸\n        \"\"\"\n        async with self.semaphore:\n            # å¦‚æœåœæ­¢,ç›´æ¥è¿”å›\n            if not self._is_running:\n                return {\"status\": \"å·²åœæ­¢\", \"user\": \"\", \"password\": \"\", \"notes\": \"ç”¨æˆ·ä¸­æ­¢\"}\n            \n            # è§„èŒƒåŒ– URL\n            if not target_url.startswith((\"http://\", \"https://\")):\n                target_url = f\"http://{target_url}\"\n            \n            # é…ç½®è¶…æ—¶\n            timeout = aiohttp.ClientTimeout(total=10)\n            \n            try:\n                async with aiohttp.ClientSession(timeout=timeout) as session:\n                    # éå†ä¸åŒçš„ç™»å½•è·¯å¾„\n                    for login_path in LOGIN_PATHS:\n                        if not self._is_running:\n                            break\n                        \n                        login_url = f\"{target_url.rstrip('/')}{login_path}\"\n                        \n                        # æ­¥éª¤1: å…ˆè®¿é—®ç™»å½•é¡µé¢\n                        try:\n                            async with session.get(\n                                login_url,\n                                ssl=False,\n                                allow_redirects=True\n                            ) as init_response:\n                                if init_response.status not in [200, 401, 403]:\n                                    continue\n                                await init_response.read()\n                        except Exception:\n                            continue\n                        \n                        # æ­¥éª¤2: å°è¯•ä¸åŒçš„å‡­è¯ç»„åˆ\n                        for cred in CREDENTIALS_LIST:\n                            if not self._is_running:\n                                break\n                                \n                            username = cred[\"username\"]\n                            password = cred[\"password\"]\n                            \n                            # æ­¥éª¤3: å°è¯•ä¸åŒçš„å­—æ®µåå˜ä½“\n                            for field_variant in FIELD_NAME_VARIANTS:\n                                if not self._is_running:\n                                    break\n                                \n                                # æ›´æ–°çŠ¶æ€ (é€šè¿‡å›è°ƒ)\n                                if self.on_row_update:\n                                    self.on_row_update(\n                                        row,\n                                        f\"å°è¯• {username}/***\",\n                                        \"\",\n                                        \"\",\n                                        f\"è·¯å¾„:{login_path}\"\n                                    )\n                                \n                                try:\n                                    # æ„å»ºè¡¨å•æ•°æ®\n                                    data = {\n                                        field_variant[\"username\"]: username,\n                                        field_variant[\"password\"]: password\n                                    }\n                                    \n                                    # å‘é€ POST ç™»å½•è¯·æ±‚\n                                    async with session.post(\n                                        login_url,\n                                        data=data,\n                                        ssl=False,\n                                        allow_redirects=False\n                                    ) as response:\n                                        # æ£€æŸ¥æ˜¯å¦ç™»å½•æˆåŠŸ\n                                        cookies = response.cookies\n                                        has_sysauth = any('sysauth' in str(cookie.key) for cookie in cookies.values())\n                                        is_redirect = response.status in [302, 303]\n                                        \n                                        if has_sysauth or is_redirect:\n                                            # ç™»å½•æˆåŠŸ!\n                                            if self.on_row_update:\n                                                self.on_row_update(\n                                                    row,\n                                                    \"ç™»å½•æˆåŠŸ\",\n                                                    username,\n                                                    password,\n                                                    f\"è·¯å¾„:{login_path}\"\n                                                )\n                                            return {\n                                                \"status\": \"ç™»å½•æˆåŠŸ\",\n                                                \"user\": username,\n                                                \"password\": password,\n                                                \"notes\": f\"è·¯å¾„:{login_path}\"\n                                            }\n                                \n                                except Exception as e:\n                                    # æ­¤ç»„åˆå¤±è´¥,ç»§ç»­ä¸‹ä¸€ä¸ª\n                                    continue\n                    \n                    # æ‰€æœ‰å°è¯•å‡å¤±è´¥\n                    if self.on_row_update:\n                        self.on_row_update(row, \"ç™»å½•å¤±è´¥\", \"\", \"\", \"æ‰€æœ‰å‡­è¯å‡å¤±è´¥\")\n                    return {\"status\": \"ç™»å½•å¤±è´¥\", \"user\": \"\", \"password\": \"\", \"notes\": \"æ‰€æœ‰å‡­è¯å‡å¤±è´¥\"}\n            \n            except asyncio.TimeoutError:\n                if self.on_row_update:\n                    self.on_row_update(row, \"è¿æ¥è¶…æ—¶\", \"\", \"\", \"æ— æ³•è¿æ¥åˆ°è®¾å¤‡\")\n                return {\"status\": \"è¿æ¥è¶…æ—¶\", \"user\": \"\", \"password\": \"\", \"notes\": \"\"}\n            except Exception as e:\n                if self.on_row_update:\n                    self.on_row_update(row, \"è¿æ¥å¤±è´¥\", \"\", \"\", str(e)[:50])\n                return {\"status\": \"è¿æ¥å¤±è´¥\", \"user\": \"\", \"password\": \"\", \"notes\": str(e)[:50]}\n    \n    async def batch_detect(self, targets: List[str]):\n        \"\"\"æ‰¹é‡æ¢æµ‹\"\"\"\n        self._is_running = True\n        self._tasks = []\n        \n        # åˆ›å»ºæ‰€æœ‰ä»»åŠ¡\n        for idx, target in enumerate(targets):\n            task = asyncio.create_task(self.detect_login(idx, target))\n            self._tasks.append(task)\n        \n        # ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ\n        await asyncio.gather(*self._tasks, return_exceptions=True)\n        \n        # å‘é€å®Œæˆä¿¡å· (é€šè¿‡å›è°ƒ)\n        if self.on_task_finished:\n            self.on_task_finished()\n    \n    def stop(self):\n        \"\"\"åœæ­¢æ‰€æœ‰ä»»åŠ¡\"\"\"\n        self._is_running = False\n        for task in self._tasks:\n            if not task.done():\n                task.cancel()\n"}, {"path": "f_app.py", "content": "\nimport flet as ft\nimport asyncio\nimport csv\nimport json\nfrom datetime import datetime\nfrom flet_login_manager import FletLoginManager\n\n# Apple Design System Constants\nclass MacColors:\n    SIDEBAR_BG = \"#F5F5F7\"  # Light gray sidebar\n    SIDEBAR_BORDER = \"#D1D1D6\"\n    CONTENT_BG = \"#FFFFFF\"\n    TEXT_PRIMARY = \"#1D1D1F\"\n    TEXT_SECONDARY = \"#86868B\"\n    ACCENT_BLUE = \"#007AFF\"\n    SUCCESS_GREEN = \"#34C759\"\n    WARNING_ORANGE = \"#FF9500\"\n    ERROR_RED = \"#FF3B30\"\n    DIVIDER = \"#E5E5EA\"\n    WINDOW_BG = \"#00000000\" # Transparent\n\ndef main(page: ft.Page):\n    # Window Configuration\n    page.title = \"OpenWrt Manager\"\n    page.window_width = 1200\n    page.window_height = 800\n    page.window_resizable = True\n    page.window_title_bar_hidden = True  # Hide system titlebar\n    page.window_frameless = True  # Frameless window (macOS style)\n    page.padding = 0\n    page.spacing = 0\n    \n    # Global Font Theme (Critical: Remove default Roboto)\n    page.theme = ft.Theme(\n        font_family=\"SF Pro Display\",  # macOS default\n    )\n    # Fallback fonts for Windows/Linux\n    page.fonts = {\n        \"SF Pro Display\": \"https://fonts.cdnfonts.com/s/16550/SFProDisplay-Regular.woff\", \n        \"PingFang SC\": \"simhei\", # Fallback for Windows\n    }\n    \n    print(\"Flet App Started! Initializing UI...\") # Debug log\n\n    # Custom Title Bar (simulating macOS traffic lights)\n    def window_drag_area(e):\n\n        page.window_drag_area()\n\n    title_bar = ft.Container(\n        content=ft.WindowDragArea(\n            content=ft.Row(\n                controls=[\n                    # Mac Traffic Lights (Left aligned)\n                    ft.Row(\n                        [\n                            ft.Container(\n                                width=12, height=12, \n                                border_radius=6, \n                                bgcolor=\"#FF5F57\", # Red\n                                on_click=lambda _: page.window_close()\n                            ),\n                            ft.Container(\n                                width=12, height=12, \n                                border_radius=6, \n                                bgcolor=\"#FEBC2E\", # Yellow\n                                on_click=lambda _: page.window_minimized()\n                            ),\n                            ft.Container(\n                                width=12, height=12, \n                                border_radius=6, \n                                bgcolor=\"#28C840\", # Green\n                                on_click=lambda _: page.window_maximized() # Should maximize/restore\n                            ),\n                        ],\n                        spacing=8,\n                    ),\n                    \n                    # Title (Centered)\n                    ft.Row(\n                        [\n                            ft.Text(\"OpenWrt Manager\", size=13, weight=ft.FontWeight.W_500, color=\"#4d4d4d\"),\n                            ft.Text(\"v2.0\", size=11, color=\"#8e8e8e\"),\n                        ],\n                        spacing=6,\n                        alignment=ft.MainAxisAlignment.CENTER,\n                    ),\n\n                    # Spacer for balance (approximate width of traffic lights + padding)\n                    ft.Container(width=52), \n                ],\n                alignment=ft.MainAxisAlignment.SPACE_BETWEEN,\n                vertical_alignment=ft.CrossAxisAlignment.CENTER,\n            ),\n        ),\n        height=52,\n        # Gradient background to match Web v0.app\n        gradient=ft.LinearGradient(\n            begin=ft.Alignment(0, -1),\n            end=ft.Alignment(0, 1),\n            colors=[\"#E8E8E8\", \"#D4D4D4\"],\n        ),\n        padding=ft.Padding(left=16, right=16, top=0, bottom=0),\n        border=ft.Border(bottom=ft.BorderSide(1, \"#B8B8B8\")), # Darker border to match Web\n    )\n\n    # === Export Functions ===\n    def export_csv():\n        \"\"\"Export table data to CSV\"\"\"\n        if not data_table.rows:\n            return\n        filename = f\"openwrt_results_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv\"\n        with open(filename, 'w', newline='', encoding='utf-8') as f:\n            writer = csv.writer(f)\n            writer.writerow([\"#\", \"åœ°å€\", \"çŠ¶æ€\", \"ç”¨æˆ·å\", \"å¯†ç \", \"è¯¦æƒ…\"])\n            for row in data_table.rows:\n                writer.writerow([cell.content.value for cell in row.cells])\n        page.snack_bar = ft.SnackBar(ft.Text(f\"å·²å¯¼å‡ºåˆ° {filename}\"))\n        page.snack_bar.open = True\n        page.update()\n    \n    def export_json():\n        \"\"\"Export table data to JSON\"\"\"\n        if not data_table.rows:\n            return\n        data = []\n        for row in data_table.rows:\n            data.append({\n                \"åºå·\": row.cells[0].content.value,\n                \"åœ°å€\": row.cells[1].content.value,\n                \"çŠ¶æ€\": row.cells[2].content.value,\n                \"ç”¨æˆ·å\": row.cells[3].content.value,\n                \"å¯†ç \": row.cells[4].content.value,\n                \"è¯¦æƒ…\": row.cells[5].content.value,\n            })\n        filename = f\"openwrt_results_{datetime.now().strftime('%Y%m%d_%H%M%S')}.json\"\n        with open(filename, 'w', encoding='utf-8') as f:\n            json.dump(data, f, ensure_ascii=False, indent=2)\n        page.snack_bar = ft.SnackBar(ft.Text(f\"å·²å¯¼å‡ºåˆ° {filename}\"))\n        page.snack_bar.open = True\n        page.update()\n    \n    def export_excel():\n        \"\"\"Export table data to Excel (requires openpyxl)\"\"\"\n        page.snack_bar = ft.SnackBar(ft.Text(\"Excelå¯¼å‡ºéœ€è¦å®‰è£… openpyxl åº“\"))\n        page.snack_bar.open = True\n        page.update()\n    \n    def export_markdown():\n        \"\"\"Export table data to Markdown\"\"\"\n        if not data_table.rows:\n            return\n        filename = f\"openwrt_results_{datetime.now().strftime('%Y%m%d_%H%M%S')}.md\"\n        with open(filename, 'w', encoding='utf-8') as f:\n            f.write(\"# OpenWrt Manager æ‰«æç»“æœ\\n\\n\")\n            f.write(\"| # | åœ°å€ | çŠ¶æ€ | ç”¨æˆ·å | å¯†ç  | è¯¦æƒ… |\\n\")\n            f.write(\"|---|------|------|--------|------|------|\\n\")\n            for row in data_table.rows:\n                cells = [cell.content.value for cell in row.cells]\n                f.write(f\"| {' | '.join(str(c) for c in cells)} |\\n\")\n        page.snack_bar = ft.SnackBar(ft.Text(f\"å·²å¯¼å‡ºåˆ° {filename}\"))\n        page.snack_bar.open = True\n        page.update()\n    \n    # === MenuBar (28px height, matching PyQt MacMenuBar) ===\n    def create_menu_item(label, is_bold=False, items=None, on_click_handlers=None):\n        \"\"\"Create a menu item with optional dropdown\"\"\"\n        if items is None:\n            # Simple text label (e.g., \"OpenWrt Manager\")\n            return ft.Text(\n                label,\n                size=13,\n                color=\"#1d1d1f\",\n                weight=ft.FontWeight.W_500 if is_bold else ft.FontWeight.NORMAL,\n            )\n        else:\n            # PopupMenuButton with dropdown\n            menu_items = []\n            for i, item in enumerate(items):\n                if item == \"---\":\n                    menu_items.append(ft.Divider(height=1))\n                else:\n                    handler = on_click_handlers[i] if on_click_handlers and i < len(on_click_handlers) else None\n                    menu_items.append(\n                        ft.PopupMenuItem(\n                            content=ft.Text(item, size=13),\n                            on_click=handler\n                        )\n                    )\n            return ft.PopupMenuButton(\n                content=ft.Text(label, size=13, color=\"#1d1d1f\"),\n                items=menu_items,\n            )\n    \n    menubar = ft.Container(\n        height=28,\n        bgcolor=\"#f0f0f0\",  # Menubar background\n        border=ft.Border(bottom=ft.BorderSide(1, \"#d1d1d6\")),\n        padding=ft.Padding(left=12, right=12, top=0, bottom=0),\n        content=ft.Row([\n            create_menu_item(\"OpenWrt Manager\", is_bold=True),\n            create_menu_item(\"æ–‡ä»¶\", items=[\"æ–°å»º\", \"æ‰“å¼€...\", \"---\", \"å¯¼å‡º\"], \n                           on_click_handlers=[None, None, None, lambda e: export_csv()]),\n            create_menu_item(\"ç¼–è¾‘\", items=[\"æ’¤é”€\", \"é‡åš\", \"---\", \"å‰ªåˆ‡\", \"å¤åˆ¶\", \"ç²˜è´´\"]),\n            create_menu_item(\"è§†å›¾\", items=[\"ç¤ºä¾‹é€‰é¡¹ 1\", \"ç¤ºä¾‹é€‰é¡¹ 2\"]),\n            create_menu_item(\"æ‰«æ\", items=[\"ç¤ºä¾‹é€‰é¡¹ 1\", \"ç¤ºä¾‹é€‰é¡¹ 2\"]),\n            create_menu_item(\"çª—å£\", items=[\"ç¤ºä¾‹é€‰é¡¹ 1\", \"ç¤ºä¾‹é€‰é¡¹ 2\"]),\n            create_menu_item(\"å¸®åŠ©\", items=[\"ç¤ºä¾‹é€‰é¡¹ 1\", \"ç¤ºä¾‹é€‰é¡¹ 2\"]),\n        ], spacing=10)\n    )\n\n    # Sidebar Component\n    def sidebar_item(icon_text, label, selected=False):\n        return ft.Container(\n            content=ft.Row(\n                [\n                    ft.Text(\n                        icon_text,  # Using text/emoji instead of icons\n                        size=18, \n                        color=MacColors.ACCENT_BLUE if selected else MacColors.TEXT_PRIMARY\n                    ),\n                    ft.Text(\n                        label, \n                        size=13, \n                        weight=ft.FontWeight.W_500 if selected else ft.FontWeight.NORMAL,\n                        color=MacColors.ACCENT_BLUE if selected else MacColors.TEXT_PRIMARY\n                    )\n                ],\n                spacing=10\n            ),\n            padding=ft.Padding(left=12, right=12, top=8, bottom=8),\n            border_radius=6,\n            bgcolor=ft.Colors.with_opacity(0.1, MacColors.ACCENT_BLUE) if selected else None,\n            on_hover=lambda e: e.control.update()\n        )\n\n    # URL Input Field (Custom Web-style Container)\n    # Removing Material TextField borders by wrapping in Container to match v0.app Textarea\n    url_input_field = ft.TextField(\n        multiline=True,\n        hint_text=\"è¾“å…¥ IP åœ°å€ï¼Œæ¯è¡Œä¸€ä¸ª...\",\n        hint_style=ft.TextStyle(color=\"#8E8E8E\", size=13), # Match Colors.Light.TEXT_PLACEHOLDER\n        border=ft.InputBorder.NONE,  # Remove internal border\n        min_lines=6,\n        max_lines=10,\n        text_size=13,\n        content_padding=ft.Padding(12, 8, 12, 8), # Match design_system.py: 8px V, 12px H\n        cursor_color=MacColors.ACCENT_BLUE,\n    )\n    \n    url_input_container = ft.Container(\n        content=url_input_field,\n        height=200, # Match Web: min-h-[200px]\n        bgcolor=ft.Colors.WHITE,\n        border=ft.Border.all(1, \"#C7C7C7\"),\n        border_radius=6,\n        padding=0,\n    )\n    \n    # Event handler for input change (to toggle button color)\n    def on_url_change(e):\n        nonlocal is_running\n        if is_running: return\n        has_text = len(e.control.value.strip()) > 0\n        # Visual State Logic: Grey (Disabled) <-> Blue (Active)\n        start_button.bgcolor = MacColors.ACCENT_BLUE if has_text else \"#E5E5EA\"\n        start_button.color = ft.Colors.WHITE if has_text else \"#8E8E93\"\n        start_button.update()\n    \n    url_input_field.on_change = on_url_change\n    \n    # Concurrent Dropdown (40px height to match h-10)\n    concurrent_dropdown = ft.Dropdown(\n        options=[\n            ft.dropdown.Option(\"50\"),\n            ft.dropdown.Option(\"100\"),\n            ft.dropdown.Option(\"200\"),\n        ],\n        value=\"50\",\n        width=80,\n        height=40, # Match Web: h-10 (40px)\n        text_size=13,\n        content_padding=10,\n        # alignment removed - unsupported in Dropdown\n        border_color=\"#C7C7C7\", # Match border-[#c7c7c7]\n        border_radius=6,\n    )\n    \n    start_button = ft.Container(\n        content=ft.Row(\n            [\n                ft.Icon(ft.Icons.PLAY_ARROW_ROUNDED, size=16, color=\"#ffffff\"),\n                ft.Text(\"å¼€å§‹æ¢æµ‹\", size=13, weight=ft.FontWeight.W_500, color=\"#ffffff\"),\n            ],\n            alignment=ft.MainAxisAlignment.CENTER,\n            spacing=4,\n        ),\n        bgcolor=\"#E5E5EA\", # Default disabled color\n        border_radius=6,\n        padding=ft.Padding(16, 0, 16, 0),\n        height=40, # Match Web: h-10 (40px)\n        on_click=None, # Initially disabled\n        animate=ft.Animation(300, ft.AnimationCurve.EASE_OUT),\n    )\n\n    # Empty State - UPDATED to match Web v0.app (Pulse Icon + \"æš‚æ— ç»“æœ\")\n    empty_state = ft.Container(\n        content=ft.Column(\n            [\n                ft.Icon(ft.Icons.MONITOR_HEART_OUTLINED, size=40, color=\"#C7C7C7\"), # Match Web: w-10 h-10 (40px)\n                ft.Container(height=12),\n                ft.Text(\"æš‚æ— ç»“æœ\", size=15, weight=ft.FontWeight.W_500, color=\"#1D1D1F\"), # Match Web: text-[15px]\n                ft.Text(\"è¾“å…¥ç›®æ ‡åœ°å€å¹¶ç‚¹å‡»å¼€å§‹æ¢æµ‹\", size=13, color=\"#8E8E8E\"), # Match Web: text-[13px]\n            ],\n            alignment=ft.MainAxisAlignment.CENTER,\n            horizontal_alignment=ft.CrossAxisAlignment.CENTER,\n            spacing=2,\n        ),\n        alignment=ft.Alignment(0, 0),\n        expand=True,\n    )\n    \n    # Create stat label references for later updates\n    stat_success = ft.Text(\"0\", size=13, color=\"#34c759\", weight=ft.FontWeight.W_600)\n    stat_failed = ft.Text(\"0\", size=13, color=\"#ff3b30\", weight=ft.FontWeight.W_600)\n    stat_waiting = ft.Text(\"0\", size=13, color=\"#ff9500\", weight=ft.FontWeight.W_600)\n    \n    sidebar = ft.Container(\n        width=280,  # Match PyQt: 280px\n        bgcolor=MacColors.SIDEBAR_BG,\n        border=ft.Border(right=ft.BorderSide(1, MacColors.SIDEBAR_BORDER)),\n        padding=ft.Padding(left=16, right=16, top=16, bottom=16),\n        content=ft.Column(\n            [\n                # === ç›®æ ‡ === (changed from \"è¾“å…¥\")\n                ft.Text(\"ç›®æ ‡\", size=11, color=\"#8e8e8e\", weight=ft.FontWeight.W_600),\n                # Spacing Correction: Web Source uses mb-2 which is 0.5rem = 8px.\n                ft.Container(height=8),\n                url_input_container, # Use the wrapped container\n                ft.Container(height=12),\n                ft.Row(\n                    [\n                        ft.Container(content=concurrent_dropdown, expand=2),\n                        ft.Container(width=12),\n                        ft.Container(content=start_button, expand=3),\n                    ],\n                    alignment=ft.MainAxisAlignment.SPACE_BETWEEN\n                ),\n\n                ft.Container(height=24),\n                \n                # === æ¦‚è§ˆç»Ÿè®¡ï¼ˆåº•éƒ¨ï¼‰===\n                ft.Container(\n                    border=ft.Border(top=ft.BorderSide(1, \"#d1d1d6\")),\n                    padding=ft.Padding(left=0, right=0, top=12, bottom=0),\n                    margin=ft.Margin(0, 8, 0, 0),\n                    content=ft.Column([\n                        ft.Text(\"æ¦‚è§ˆ\", size=11, color=\"#8e8e8e\", weight=ft.FontWeight.W_600),\n                        ft.Container(height=6),\n                        \n                        # æˆåŠŸ\n                        ft.Row([\n                            ft.Text(\"æˆåŠŸ\", size=13, color=\"#1d1d1f\"),\n                            ft.Container(expand=True),\n                            stat_success,\n                        ], spacing=0),\n                        ft.Container(height=6),  # Changed from 2px to 6px\n                        \n                        # å¤±è´¥\n                        ft.Row([\n                            ft.Text(\"å¤±è´¥\", size=13, color=\"#1d1d1f\"),\n                            ft.Container(expand=True),\n                            stat_failed,\n                        ], spacing=0),\n                        ft.Container(height=6),  # Changed from 2px to 6px\n                        \n                        # ç­‰å¾…ä¸­\n                        ft.Row([\n                            ft.Text(\"ç­‰å¾…ä¸­\", size=13, color=\"#1d1d1f\"),\n                            ft.Container(expand=True),\n                            stat_waiting,\n                        ], spacing=0),\n                    ], spacing=0)\n                ),\n            ],\n            spacing=0  # Use explicit Container heights instead\n        )\n    )\n\n    # Main Content Area\n    \n    # Stats Card Component\n    def stat_card(title, value, color):\n        return ft.Container(\n            expand=1,\n            padding=16,\n            border_radius=10,\n            bgcolor=ft.Colors.WHITE,\n            border=ft.Border.all(width=0.5, color=MacColors.DIVIDER),  # Fixed deprecated API\n            shadow=ft.BoxShadow(\n                spread_radius=0,\n                blur_radius=10,\n                color=ft.Colors.with_opacity(0.05, \"#000000\"),\n                offset=ft.Offset(0, 4),\n            ),\n            content=ft.Column(\n                [\n                    ft.Text(title, size=12, color=MacColors.TEXT_SECONDARY),\n                    ft.Text(value, size=24, weight=ft.FontWeight.BOLD, color=color),\n                ],\n                spacing=4\n            )\n        )\n\n    # Data Table Component (6åˆ—: #, åœ°å€, çŠ¶æ€, ç”¨æˆ·å, å¯†ç , è¯¦æƒ…)\n    data_table = ft.DataTable(\n        columns=[\n            ft.DataColumn(ft.Text(\"#\")),\n            ft.DataColumn(ft.Text(\"åœ°å€\")),\n            ft.DataColumn(ft.Text(\"çŠ¶æ€\")),\n            ft.DataColumn(ft.Text(\"ç”¨æˆ·å\")),\n            ft.DataColumn(ft.Text(\"å¯†ç \")),\n            ft.DataColumn(ft.Text(\"è¯¦æƒ…\")),\n        ],\n        rows=[],  # Empty initially, will be populated dynamically\n        width=float(\"inf\"),\n        heading_row_height=40,\n        data_row_min_height=48,\n        divider_thickness=0.5,\n        heading_text_style=ft.TextStyle(size=12, color=MacColors.TEXT_SECONDARY, weight=ft.FontWeight.W_500),\n    )\n\n    # ========================================================================\n    # LoginManager Integration\n    # ========================================================================\n    \n    # Initialize LoginManager\n    login_manager = FletLoginManager(max_concurrent=50)\n    is_running = False  # Track detection state\n    \n    # Status color mapping\n    def get_status_color(status: str):\n        if \"æˆåŠŸ\" in status:\n            return MacColors.SUCCESS_GREEN\n        elif \"å¤±è´¥\" in status or \"è¶…æ—¶\" in status:\n            return MacColors.ERROR_RED\n        else:\n            return MacColors.WARNING_ORANGE\n    \n    # Callback: Update table row\n    def handle_row_update(row: int, status: str, user: str, password: str, notes: str):\n        if row < len(data_table.rows):\n            # Update existing row (6åˆ—: index 0=#, 1=åœ°å€, 2=çŠ¶æ€, 3=ç”¨æˆ·å, 4=å¯†ç , 5=è¯¦æƒ…)\n            data_table.rows[row].cells[2].content = ft.Container(\n                content=ft.Text(status, size=12, color=get_status_color(status)),\n                padding=ft.Padding(left=8, right=8, top=4, bottom=4),\n                border_radius=12,\n                bgcolor=ft.Colors.with_opacity(0.1, get_status_color(status))\n            )\n            data_table.rows[row].cells[3].content = ft.Text(user, size=13)\n            data_table.rows[row].cells[4].content = ft.Text(password, size=13)\n            data_table.rows[row].cells[5].content = ft.Text(notes, size=12, color=MacColors.TEXT_SECONDARY)\n            \n            # Update statistics\n            success_count = sum(1 for r in data_table.rows if \"æˆåŠŸ\" in str(r.cells[2].content.content.value))\n            failed_count = sum(1 for r in data_table.rows if (\"å¤±è´¥\" in str(r.cells[2].content.content.value) or \"è¶…æ—¶\" in str(r.cells[2].content.content.value)))\n            waiting_count = len(data_table.rows) - success_count - failed_count\n            \n            stat_success.value = str(success_count)\n            stat_failed.value = str(failed_count)\n            stat_waiting.value = str(waiting_count)\n            \n            page.update()\n    \n    # Callback: Task finished\n    def handle_task_finished():\n        nonlocal is_running\n        is_running = False\n        start_button.text = \"å¼€å§‹æ¢æµ‹\"\n        start_button.bgcolor = MacColors.ACCENT_BLUE\n        url_input_field.disabled = False\n        concurrent_dropdown.disabled = False\n        page.update()\n    \n    # Start detection handler\n    async def start_detection(e):\n        nonlocal is_running\n        \n        if is_running:\n            # Stop detection\n            login_manager.stop()\n            handle_task_finished()\n            return\n        \n        # Get URLs from input\n        urls = url_input_field.value.strip().split('\\n') if url_input_field.value else []\n        urls = [url.strip() for url in urls if url.strip()]\n        \n        if not urls:\n            # Show error (TODO: add snackbar)\n            print(\"No URLs entered!\")\n            return\n        \n        # Update UI state\n        is_running = True\n        start_button.text = \"åœæ­¢æ¢æµ‹\"\n        start_button.bgcolor = MacColors.ERROR_RED\n        url_input_field.disabled = True\n        concurrent_dropdown.disabled = True\n        \n        # Show table, hide empty state\n        empty_state.visible = False\n        table_container.visible = True\n        \n        # Update concurrency\n        login_manager.max_concurrent = int(concurrent_dropdown.value)\n        login_manager.semaphore = asyncio.Semaphore(int(concurrent_dropdown.value))\n        \n        # Initialize table rows (6åˆ—: åºå·, åœ°å€, çŠ¶æ€, ç”¨æˆ·å, å¯†ç , è¯¦æƒ…)\n        data_table.rows.clear()\n        for idx, url in enumerate(urls):\n            data_table.rows.append(\n                ft.DataRow(cells=[\n                    ft.DataCell(ft.Text(str(idx + 1), size=13)),  # #\n                    ft.DataCell(ft.Text(url, size=13)),  # åœ°å€\n                    ft.DataCell(ft.Text(\"æ£€æµ‹ä¸­\", size=13, color=get_status_color(\"æ£€æµ‹ä¸­\"))),  # çŠ¶æ€\n                    ft.DataCell(ft.Text(\"\", size=13)),  # ç”¨æˆ·å\n                    ft.DataCell(ft.Text(\"\", size=13)),  # å¯†ç \n                    ft.DataCell(ft.Text(\"\", size=13)),  # è¯¦æƒ…\n                ])\n            )\n        \n        # Update statistics\n        stat_success.value = \"0\"\n        stat_failed.value = \"0\"\n        stat_waiting.value = str(len(urls))\n        \n        # Toggle UI: hide Empty State, show Table\n        empty_state.visible = False\n        table_container.visible = True\n        \n        # Start breathing light animation\n        toggle_breathing_light(True)\n        \n        page.update()\n        \n        # Register callbacks\n        login_manager.on_row_update = handle_row_update\n        login_manager.on_task_finished = handle_task_finished\n        \n        # Start batch detection\n        await login_manager.batch_detect(urls)\n    \n    # Bind button click event\n    start_button.on_click = start_detection\n    \n    # ========================================================================\n    # End of LoginManager Integration\n    # ========================================================================\n    \n    # === Toolbar (40px height) ===\n    # Breathing light state (will be animated)\n    breathing_light_ref = ft.Ref[ft.Container]()\n    breathing_light_opacity = 0.3\n    breathing_light_active = False\n    \n    async def breathing_light_animation():\n        \"\"\"Breathing light animation loop (1.5s cycle)\"\"\"\n        import math\n        while True:\n            if breathing_light_active and breathing_light_ref.current:\n                # Calculate opacity using sine wave (0.3 to 1.0)\n                elapsed = asyncio.get_event_loop().time()\n                opacity = 0.3 + 0.7 * (math.sin(elapsed * 2 * math.pi / 1.5) + 1) / 2\n                breathing_light_ref.current.opacity = opacity\n                page.update()\n            await asyncio.sleep(0.05)  # 50ms update interval\n    \n    def toggle_breathing_light(active: bool):\n        \"\"\"Toggle breathing light animation\"\"\"\n        nonlocal breathing_light_active\n        breathing_light_active = active\n        if active:\n            breathing_light_ref.current.bgcolor = \"#00ff00\"  # Green\n        else:\n            breathing_light_ref.current.bgcolor = \"#808080\"  # Gray\n            breathing_light_ref.current.opacity = 0.3\n        page.update()\n    \n    toolbar = ft.Container(\n        height=40,\n        bgcolor=\"#f5f5f7\",  # BG_TABLEHEAD\n        border=ft.Border(bottom=ft.BorderSide(1, \"#e5e5ea\")),  # BORDER_SECONDARY\n        padding=ft.Padding(left=16, right=16, top=0, bottom=0),\n        content=ft.Row([\n            ft.Text(\"ç»“æœ\", size=11, color=\"#8e8e8e\", weight=ft.FontWeight.W_600),\n            ft.Container(expand=True),\n            \n            # Breathing light (20x20px circle)\n            ft.Container(\n                ref=breathing_light_ref,\n                width=20,\n                height=20,\n                border_radius=10,  # Circle\n                bgcolor=\"#808080\",  # Gray (inactive)\n                opacity=0.3,\n            ),\n            \n            ft.Container(width=12),\n            \n            # Export button (Outlined Style matching v0.app)\n            # Replaces simple text with specific icon+text+arrow layout in a bordered container\n            ft.PopupMenuButton(\n                content=ft.Container(\n                    content=ft.Row(\n                        [\n                            ft.Icon(ft.Icons.FILE_UPLOAD_OUTLINED, size=14, color=MacColors.TEXT_PRIMARY),\n                            ft.Text(\"å¯¼å‡º\", size=12, color=MacColors.TEXT_PRIMARY, weight=ft.FontWeight.W_500),\n                            ft.Icon(ft.Icons.KEYBOARD_ARROW_DOWN, size=14, color=MacColors.TEXT_SECONDARY),\n                        ],\n                        spacing=4,\n                        alignment=ft.MainAxisAlignment.CENTER,\n                    ),\n                    padding=ft.Padding(8, 4, 8, 4),\n                    border=ft.Border.all(1, \"#E5E5EA\"), # The specific grey border\n                    border_radius=6,\n                    bgcolor=ft.Colors.WHITE,\n                ),\n                items=[\n                    ft.PopupMenuItem(content=ft.Text(\"ğŸ“„ CSV æ ¼å¼\", size=13), on_click=lambda e: export_csv()),\n                    ft.PopupMenuItem(content=ft.Text(\"ğŸ“Š Excel æ ¼å¼\", size=13), on_click=lambda e: export_excel()),\n                    ft.PopupMenuItem(content=ft.Text(\"ğŸ“‹ JSON æ ¼å¼\", size=13), on_click=lambda e: export_json()),\n                    ft.PopupMenuItem(content=ft.Text(\"ğŸ“ Markdown\", size=13), on_click=lambda e: export_markdown()),\n                    ft.Divider(height=1),\n                    ft.PopupMenuItem(content=ft.Text(\"ğŸ–¨ï¸ æ‰“å°é¢„è§ˆ\", size=13)),\n                ],\n                tooltip=\"å¯¼å‡ºç»“æœ\",\n            ),\n        ], alignment=ft.MainAxisAlignment.START, vertical_alignment=ft.CrossAxisAlignment.CENTER)\n    )\n    \n    # Empty State Component\n    empty_state = ft.Container(\n        expand=True,\n        content=ft.Column([\n            ft.Icon(\n                ft.Icons.BOLT,  # âš¡ Lightning bolt (verified: capital I)\n                size=64,\n                color=\"#86868B\",  # Grey (matching PyQt original)\n            ),\n            ft.Container(height=16),\n            ft.Text(\n                \"ç‚¹å‡»ã€Œå¼€å§‹æ¢æµ‹ã€ä»¥å¯åŠ¨\",\n                size=16,\n                color=\"#86868B\",\n            ),\n        ], \n        horizontal_alignment=ft.CrossAxisAlignment.CENTER,\n        alignment=ft.MainAxisAlignment.CENTER)  # Use MainAxisAlignment for vertical centering\n    )\n    \n    # Table container (initially hidden)\n    table_container = ft.Container(\n        content=data_table,\n        border=ft.Border.all(width=0.5, color=MacColors.DIVIDER),  # Fixed deprecated API\n        border_radius=10,\n        visible=False,\n    )\n    \n    main_content = ft.Container(\n        expand=True,\n        bgcolor=\"#ffffff\",\n        content=ft.Column(\n            [\n                toolbar,  # Added toolbar at the top\n                ft.Stack(\n                    [\n                        empty_state,\n                        table_container\n                    ],\n                    expand=True\n                )\n            ],\n            spacing=0,\n            expand=True\n        )\n    )\n\n    \n    # Root Layout (no wrapper needed - Flet is native!)\n    layout = ft.Column(\n        [\n            title_bar,\n            menubar,\n            ft.Row(\n                [\n                    sidebar,\n                    main_content\n                ],\n                expand=True,\n                spacing=0\n            )\n        ],\n        spacing=0,\n        expand=True\n    )\n    \n    # Apply Blur Effect to Sidebar (Flet 0.22+ supports blur on Container)\n    # Note: Blur is tricky without specific backend support, but we try standard properties\n    sidebar.blur = 10 \n\n    page.add(layout)\n    \n    # Start breathing light animation loop\n    page.run_task(breathing_light_animation)\n\nif __name__ == \"__main__\":\n    print(\"Launching Flet app...\")\n    ft.run(main)  # Modern API (ft.app is deprecated)\n"}, {"path": "f_app_backup_poc.py", "content": "\nimport flet as ft\nimport asyncio\n\n# Apple Design System Constants\nclass MacColors:\n    SIDEBAR_BG = \"#F5F5F7\"  # Light gray sidebar\n    SIDEBAR_BORDER = \"#D1D1D6\"\n    CONTENT_BG = \"#FFFFFF\"\n    TEXT_PRIMARY = \"#1D1D1F\"\n    TEXT_SECONDARY = \"#86868B\"\n    ACCENT_BLUE = \"#007AFF\"\n    SUCCESS_GREEN = \"#34C759\"\n    WARNING_ORANGE = \"#FF9500\"\n    ERROR_RED = \"#FF3B30\"\n    DIVIDER = \"#E5E5EA\"\n    WINDOW_BG = \"#00000000\" # Transparent\n\ndef main(page: ft.Page):\n    # Window Configuration\n    page.title = \"OpenWrt Manager\"\n    page.window_width = 1000\n    page.window_height = 700\n    page.window_resizable = True\n    page.window_title_bar_hidden = False # Debug: Show title bar\n    page.window_frameless = False # Debug: Show frame\n    page.bgcolor = MacColors.SIDEBAR_BG # Debug: Visible background\n    page.padding = 0\n    page.spacing = 0\n    \n    print(\"Flet App Started! Initializing UI...\") # Debug log\n\n    # Custom Title Bar (simulating macOS traffic lights)\n    def window_drag_area(e):\n\n        page.window_drag_area()\n\n    title_bar = ft.Container(\n        content=ft.Row(\n            controls=[\n                # Mac Traffic Lights\n                ft.Row(\n                    [\n                        ft.Container(\n                            width=12, height=12, \n                            border_radius=6, \n                            bgcolor=\"#FF5F57\", # Red\n                            on_click=lambda _: page.window_close()\n                        ),\n                        ft.Container(\n                            width=12, height=12, \n                            border_radius=6, \n                            bgcolor=\"#FEBC2E\", # Yellow\n                            on_click=lambda _: page.window_minimized()\n                        ),\n                        ft.Container(\n                            width=12, height=12, \n                            border_radius=6, \n                            bgcolor=\"#28C840\", # Green\n                            on_click=lambda e: page.window_maximize()\n                        ),\n                    ],\n                    spacing=8,\n                    run_spacing=0,\n                ),\n                ft.Container(width=20), # Spacer\n                ft.WindowDragArea(\n                     ft.Text(\n                        \"OpenWrt Manager\", \n                        color=MacColors.TEXT_PRIMARY,\n                        weight=ft.FontWeight.W_500,\n                        size=13\n                    ), expand=True\n                )\n            ],\n            alignment=ft.MainAxisAlignment.START,\n            vertical_alignment=ft.CrossAxisAlignment.CENTER,\n        ),\n        height=40,\n        bgcolor=MacColors.SIDEBAR_BG,\n        padding=ft.Padding(left=16, right=16, top=0, bottom=0),\n        border=ft.Border(bottom=ft.BorderSide(0.5, MacColors.SIDEBAR_BORDER))\n    )\n\n    # Sidebar Component\n    def sidebar_item(icon_text, label, selected=False):\n        return ft.Container(\n            content=ft.Row(\n                [\n                    ft.Text(\n                        icon_text,  # Using text/emoji instead of icons\n                        size=18, \n                        color=MacColors.ACCENT_BLUE if selected else MacColors.TEXT_PRIMARY\n                    ),\n                    ft.Text(\n                        label, \n                        size=13, \n                        weight=ft.FontWeight.W_500 if selected else ft.FontWeight.NORMAL,\n                        color=MacColors.ACCENT_BLUE if selected else MacColors.TEXT_PRIMARY\n                    )\n                ],\n                spacing=10\n            ),\n            padding=ft.Padding(left=12, right=12, top=8, bottom=8),\n            border_radius=6,\n            bgcolor=ft.Colors.with_opacity(0.1, MacColors.ACCENT_BLUE) if selected else None,\n            on_hover=lambda e: e.control.update()\n        )\n\n    sidebar = ft.Container(\n        width=240,\n        bgcolor=MacColors.SIDEBAR_BG,\n        border=ft.Border(right=ft.BorderSide(0.5, MacColors.SIDEBAR_BORDER)),\n        padding=ft.Padding(left=16, right=16, top=16, bottom=16),\n        content=ft.Column(\n            [\n                ft.Text(\"MAIN\", size=11, color=MacColors.TEXT_SECONDARY, weight=ft.FontWeight.BOLD),\n                ft.Container(height=4),\n                sidebar_item(\"ğŸ“Š\", \"Overview\", True),\n                sidebar_item(\"ğŸ“\", \"Batch Login\", False),\n                sidebar_item(\"âš™ï¸\", \"Settings\", False),\n                \n                ft.Container(height=24),\n                ft.Text(\"TOOLS\", size=11, color=MacColors.TEXT_SECONDARY, weight=ft.FontWeight.BOLD),\n                ft.Container(height=4),\n                sidebar_item(\"ğŸ’»\", \"SSH Console\", False),\n                sidebar_item(\"ğŸ”\", \"Diagnostic\", False),\n            ],\n            spacing=2\n        )\n    )\n\n    # Main Content Area\n    \n    # Stats Card Component\n    def stat_card(title, value, color):\n        return ft.Container(\n            expand=1,\n            padding=16,\n            border_radius=10,\n            bgcolor=ft.Colors.WHITE,\n            border=ft.border.all(0.5, MacColors.DIVIDER),\n            shadow=ft.BoxShadow(\n                spread_radius=0,\n                blur_radius=10,\n                color=ft.Colors.with_opacity(0.05, \"#000000\"),\n                offset=ft.Offset(0, 4),\n            ),\n            content=ft.Column(\n                [\n                    ft.Text(title, size=12, color=MacColors.TEXT_SECONDARY),\n                    ft.Text(value, size=24, weight=ft.FontWeight.BOLD, color=color),\n                ],\n                spacing=4\n            )\n        )\n\n    # Data Table Component\n    data_table = ft.DataTable(\n        columns=[\n            ft.DataColumn(ft.Text(\"IP Address\")),\n            ft.DataColumn(ft.Text(\"Status\")),\n            ft.DataColumn(ft.Text(\"Latency\")),\n            ft.DataColumn(ft.Text(\"Model\")),\n        ],\n        rows=[\n            ft.DataRow(cells=[\n                ft.DataCell(ft.Text(\"192.168.1.1\")),\n                ft.DataCell(ft.Container(\n                    content=ft.Text(\"Success\", size=12, color=MacColors.SUCCESS_GREEN),\n                    padding=ft.padding.symmetric(horizontal=8, vertical=4),\n                    border_radius=12,\n                    bgcolor=ft.Colors.with_opacity(0.1, MacColors.SUCCESS_GREEN)\n                )),\n                ft.DataCell(ft.Text(\"2ms\")),\n                ft.DataCell(ft.Text(\"OpenWrt 21.02\")),\n            ]),\n            ft.DataRow(cells=[\n                ft.DataCell(ft.Text(\"192.168.1.20\")),\n                ft.DataCell(ft.Container(\n                    content=ft.Text(\"Auth Failed\", size=12, color=MacColors.ERROR_RED),\n                    padding=ft.padding.symmetric(horizontal=8, vertical=4),\n                    border_radius=12,\n                    bgcolor=ft.Colors.with_opacity(0.1, MacColors.ERROR_RED)\n                )),\n                ft.DataCell(ft.Text(\"15ms\")),\n                ft.DataCell(ft.Text(\"Unknown\")),\n            ]),\n             ft.DataRow(cells=[\n                ft.DataCell(ft.Text(\"192.168.1.55\")),\n                ft.DataCell(ft.Container(\n                    content=ft.Text(\"Pending\", size=12, color=MacColors.WARNING_ORANGE),\n                    padding=ft.padding.symmetric(horizontal=8, vertical=4),\n                    border_radius=12,\n                    bgcolor=ft.Colors.with_opacity(0.1, MacColors.WARNING_ORANGE)\n                )),\n                ft.DataCell(ft.Text(\"-\")),\n                ft.DataCell(ft.Text(\"-\")),\n            ]),\n        ],\n        width=float(\"inf\"),\n        heading_row_height=40,\n        data_row_min_height=48,\n        divider_thickness=0.5,\n        heading_text_style=ft.TextStyle(size=12, color=MacColors.TEXT_SECONDARY, weight=ft.FontWeight.W_500),\n    )\n\n    main_content = ft.Container(\n        expand=True,\n        bgcolor=MacColors.CONTENT_BG,\n        padding=24,\n        content=ft.Column(\n            [\n                ft.Row(\n                    [\n                        stat_card(\"Total Devices\", \"128\", MacColors.TEXT_PRIMARY),\n                        stat_card(\"Online\", \"96\", MacColors.SUCCESS_GREEN),\n                        stat_card(\"Offline\", \"32\", MacColors.ERROR_RED),\n                    ],\n                    spacing=16\n                ),\n                ft.Container(height=24),\n                ft.Text(\"Recent Activity\", size=16, weight=ft.FontWeight.W_600, color=MacColors.TEXT_PRIMARY),\n                ft.Container(height=12),\n                ft.Container(\n                    content=data_table,\n                    border=ft.border.all(0.5, MacColors.DIVIDER),\n                    border_radius=10,\n                )\n            ],\n            scroll=ft.ScrollMode.AUTO\n        )\n    )\n\n    # Root Layout\n    layout = ft.Column(\n        [\n            title_bar,\n            ft.Row(\n                [\n                    sidebar,\n                    main_content\n                ],\n                expand=True,\n                spacing=0\n            )\n        ],\n        spacing=0,\n        expand=True\n    )\n    \n    # Apply Blur Effect to Sidebar (Flet 0.22+ supports blur on Container)\n    # Note: Blur is tricky without specific backend support, but we try standard properties\n    sidebar.blur = 10 \n\n    page.add(layout)\n\nif __name__ == \"__main__\":\n    print(\"Launching Flet app...\")\n    ft.app(target=main)  # Using app() - run() syntax differs\n"}, {"path": "LOGIN_OPTIMIZATION.md", "content": "# OpenWrt ç™»å½•é€»è¾‘ä¼˜åŒ–è¯´æ˜\n\n## ğŸ” é—®é¢˜å‘ç°\n\nç”¨æˆ·åœ¨å®é™…æµ‹è¯•ä¸­å‘ç°ï¼Œæ‰‹åŠ¨ç™»å½• OpenWrt æ—¶å­˜åœ¨ä»¥ä¸‹è¡Œä¸ºï¼š\n\n1. **è®¿é—®æ ¹è·¯å¾„**: `http://42.227.147.231:2020`\n2. **è‡ªåŠ¨è·³è½¬**: ç­‰å¾…å‡ ç§’åè·³è½¬åˆ° `http://42.227.147.231:2020/cgi-bin/luci/`\n3. **æ˜¾ç¤ºç™»å½•é¡µ**: æµè§ˆå™¨å±•ç¤ºç™»å½•è¡¨å•\n\nè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨ä¼šï¼š\n- åˆå§‹åŒ– Session\n- è®¾ç½®å¿…è¦çš„ Cookieï¼ˆå¦‚ `sessionid`ã€`_language` ç­‰ï¼‰\n- å¯èƒ½è¿”å› CSRF Token\n\n---\n\n## âš™ï¸ åŸæœ‰é€»è¾‘çš„é—®é¢˜\n\n### æ—§ä»£ç ï¼ˆv1.0ï¼‰\n\n```python\nasync with aiohttp.ClientSession(timeout=timeout) as session:\n    # âŒ ç›´æ¥å‘é€ POST è¯·æ±‚ï¼Œè·³è¿‡äº†åˆå§‹åŒ–æ­¥éª¤\n    for cred in CREDENTIALS_LIST:\n        async with session.post(\n            login_url,  # ç›´æ¥ POST åˆ° /cgi-bin/luci\n            data={\"luci_username\": username, \"luci_password\": password}\n        ) as response:\n            # å°è¯•ç™»å½•...\n```\n\n**é—®é¢˜**ï¼š\n- âŒ æ²¡æœ‰å…ˆè®¿é—®é¡µé¢æ¥åˆå§‹åŒ– Session\n- âŒ ç¼ºå°‘æœåŠ¡å™¨è®¾ç½®çš„å¿…è¦ Cookie\n- âŒ å¯èƒ½ç¼ºå°‘ CSRF Tokenï¼ˆæ–°ç‰ˆ LuCIï¼‰\n- âŒ ä¸ç¬¦åˆçœŸå®æµè§ˆå™¨çš„è®¿é—®æµç¨‹\n\n**åæœ**ï¼š\n- éƒ¨åˆ† OpenWrt è®¾å¤‡å¯èƒ½æ‹’ç»è¯·æ±‚ï¼ˆ401/403ï¼‰\n- å³ä½¿å¯†ç æ­£ç¡®ï¼Œä¹Ÿå¯èƒ½è¿”å›\"ç™»å½•å¤±è´¥\"\n- æ–°ç‰ˆ LuCI å¯èƒ½ç›´æ¥è¿”å›\"Token æ— æ•ˆ\"\n\n---\n\n## âœ… ä¼˜åŒ–åçš„é€»è¾‘\n\n### æ–°ä»£ç ï¼ˆv1.1ï¼‰\n\n```python\nasync with aiohttp.ClientSession(timeout=timeout) as session:\n    # âœ… æ­¥éª¤1: å…ˆè®¿é—®ç™»å½•é¡µé¢ï¼Œåˆå§‹åŒ– Session\n    try:\n        async with session.get(\n            login_url,  # GET /cgi-bin/luci\n            ssl=False,\n            allow_redirects=True  # è·Ÿéšé‡å®šå‘\n        ) as init_response:\n            await init_response.read()  # ç­‰å¾…é¡µé¢åŠ è½½\n            # Session å’Œ Cookie å·²è‡ªåŠ¨ä¿å­˜\n    except Exception:\n        pass  # å³ä½¿å¤±è´¥ä¹Ÿç»§ç»­å°è¯•\n    \n    # âœ… æ­¥éª¤2: ä½¿ç”¨å·²åˆå§‹åŒ–çš„ Session å‘é€ POST ç™»å½•è¯·æ±‚\n    for cred in CREDENTIALS_LIST:\n        async with session.post(\n            login_url,\n            data={\"luci_username\": username, \"luci_password\": password}\n        ) as response:\n            # æ­¤æ—¶è¯·æ±‚åŒ…å«äº†å¿…è¦çš„ Cookie\n```\n\n**æ”¹è¿›**ï¼š\n- âœ… å…ˆå‘é€ GET è¯·æ±‚ï¼Œæ¨¡æ‹Ÿæµè§ˆå™¨é¦–æ¬¡è®¿é—®\n- âœ… è‡ªåŠ¨è·å–å¹¶ä¿å­˜ Session Cookie\n- âœ… è‡ªåŠ¨è·Ÿéš 302 é‡å®šå‘ï¼ˆå¦‚æœæœ‰ï¼‰\n- âœ… å®Œå…¨æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è¡Œä¸º\n\n---\n\n## ğŸ“Š æµç¨‹å¯¹æ¯”\n\n### ğŸŒ çœŸå®æµè§ˆå™¨æµç¨‹\n\n```\n1. GET http://42.227.147.231:2020\n   â†“\n2. æœåŠ¡å™¨è¿”å› 302 â†’ /cgi-bin/luci/\n   â†“\n3. GET http://42.227.147.231:2020/cgi-bin/luci/\n   â†“\n4. æœåŠ¡å™¨è®¾ç½® Cookie: sessionid=xxx\n   æµè§ˆå™¨ä¿å­˜ Cookie\n   â†“\n5. ç”¨æˆ·è¾“å…¥ç”¨æˆ·å/å¯†ç \n   â†“\n6. POST /cgi-bin/luci\n   Headers: Cookie: sessionid=xxx\n   Data: username=root&password=xxx\n   â†“\n7. æœåŠ¡å™¨éªŒè¯ â†’ è¿”å›ç»“æœ\n```\n\n### ğŸ¤– ç¨‹åºæµç¨‹ï¼ˆä¼˜åŒ–åï¼‰\n\n```\n1. GET http://42.227.147.231:2020/cgi-bin/luci\n   allow_redirects=Trueï¼ˆè‡ªåŠ¨è·Ÿéšï¼‰\n   â†“\n2. aiohttp è‡ªåŠ¨å¤„ç† 302 é‡å®šå‘\n   è‡ªåŠ¨ä¿å­˜ Cookie åˆ° session å¯¹è±¡\n   â†“\n3. POST /cgi-bin/luci\n   è‡ªåŠ¨æºå¸¦ Cookie: sessionid=xxx\n   Data: username=root&password=xxx\n   â†“\n4. æœåŠ¡å™¨éªŒè¯ â†’ è¿”å›ç»“æœ\n```\n\n---\n\n## ğŸ§ª æµ‹è¯•å¯¹æ¯”\n\n### æµ‹è¯•åœºæ™¯ 1: æ ‡å‡† OpenWrtï¼ˆéœ€è¦ Sessionï¼‰\n\n| ç‰ˆæœ¬ | ç»“æœ | åŸå›  |\n|------|------|------|\n| v1.0ï¼ˆæ—§ï¼‰ | âŒ ç™»å½•å¤±è´¥ | ç¼ºå°‘ Session Cookie |\n| v1.1ï¼ˆæ–°ï¼‰ | âœ… ç™»å½•æˆåŠŸ | å·²åˆå§‹åŒ– Session |\n\n### æµ‹è¯•åœºæ™¯ 2: æ–°ç‰ˆ LuCIï¼ˆéœ€è¦ Tokenï¼‰\n\n| ç‰ˆæœ¬ | ç»“æœ | åŸå›  |\n|------|------|------|\n| v1.0ï¼ˆæ—§ï¼‰ | âŒ Token æ— æ•ˆ | æœªè·å– Token |\n| v1.1ï¼ˆæ–°ï¼‰ | âš ï¸ éƒ¨åˆ†æˆåŠŸ | å·²è·å– Cookieï¼Œä½†ä»éœ€è§£æ Token |\n\n> **æ³¨**ï¼šå®Œå…¨æ”¯æŒ CSRF Token éœ€è¦è¿›ä¸€æ­¥è§£æ HTML é¡µé¢ï¼Œæå– Token å­—æ®µã€‚\n\n### æµ‹è¯•åœºæ™¯ 3: è€ç‰ˆ OpenWrtï¼ˆæ—  Session é™åˆ¶ï¼‰\n\n| ç‰ˆæœ¬ | ç»“æœ | åŸå›  |\n|------|------|------|\n| v1.0ï¼ˆæ—§ï¼‰ | âœ… ç™»å½•æˆåŠŸ | è€ç‰ˆæœ¬æ— é™åˆ¶ |\n| v1.1ï¼ˆæ–°ï¼‰ | âœ… ç™»å½•æˆåŠŸ | å‘åå…¼å®¹ |\n\n---\n\n## ğŸ’¡ æŠ€æœ¯ç»†èŠ‚\n\n### aiohttp.ClientSession çš„ Cookie ç®¡ç†\n\n```python\nasync with aiohttp.ClientSession() as session:\n    # ç¬¬ä¸€æ¬¡è¯·æ±‚\n    await session.get(\"http://example.com/\")\n    # â†’ æœåŠ¡å™¨è¿”å› Set-Cookie: sessionid=abc123\n    \n    # ç¬¬äºŒæ¬¡è¯·æ±‚ï¼ˆåŒä¸€ä¸ª sessionï¼‰\n    await session.post(\"http://example.com/login\")\n    # â†’ aiohttp è‡ªåŠ¨åœ¨è¯·æ±‚å¤´æ·»åŠ : Cookie: sessionid=abc123\n```\n\n**å…³é”®ç‚¹**ï¼š\n- `ClientSession` å¯¹è±¡ä¼šè‡ªåŠ¨ç®¡ç† Cookie\n- åœ¨åŒä¸€ä¸ª `session` å†…ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼š**è‡ªåŠ¨å…±äº« Cookie**\n- è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦å…ˆ GET å† POST\n\n### allow_redirects å‚æ•°\n\n```python\n# åˆå§‹åŒ–è¯·æ±‚ï¼šå…è®¸è·Ÿéšé‡å®šå‘\nawait session.get(url, allow_redirects=True)\n# http://example.com/ â†’ 302 â†’ http://example.com/login\n# aiohttp è‡ªåŠ¨è·Ÿéšï¼Œæœ€ç»ˆè®¿é—®ç™»å½•é¡µ\n\n# ç™»å½•è¯·æ±‚ï¼šä¸è·Ÿéšé‡å®šå‘\nawait session.post(url, allow_redirects=False)\n# è¿”å› 302 æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥ Location å¤´æ¥åˆ¤æ–­ç™»å½•æˆåŠŸ\n```\n\n---\n\n## ğŸš€ å»ºè®®çš„ä¸‹ä¸€æ­¥ä¼˜åŒ–\n\n### 1. æ”¯æŒ CSRF Tokenï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰\n\nå¦‚æœæ‚¨çš„ OpenWrt æ˜¯**æ–°ç‰ˆ LuCI**ï¼ˆå¦‚ 19.07+ï¼‰ï¼Œå¯èƒ½éœ€è¦ Tokenï¼š\n\n```python\n# 1. GET ç™»å½•é¡µé¢\nasync with session.get(login_url) as resp:\n    html = await resp.text()\n    \n# 2. è§£æ Token\nimport re\ntoken_match = re.search(r'name=\"token\" value=\"([^\"]+)\"', html)\nif token_match:\n    token = token_match.group(1)\n\n# 3. POST æ—¶å¸¦ä¸Š Token\ndata = {\n    \"luci_username\": username,\n    \"luci_password\": password,\n    \"token\": token  # ğŸ†• æ·»åŠ  Token\n}\n```\n\n### 2. å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆå»ºè®®ï¼‰\n\nè€ƒè™‘åˆ°æ‚¨æåˆ°çš„\"å‡ ç§’ç­‰å¾…æ—¶é—´\"ï¼Œå¯ä»¥å¢åŠ è¶…æ—¶ï¼š\n\n```python\n# ä» 8 ç§’å¢åŠ åˆ° 15 ç§’\ntimeout = aiohttp.ClientTimeout(total=15)\n```\n\n### 3. æ·»åŠ è°ƒè¯•æ—¥å¿—ï¼ˆå¯é€‰ï¼‰\n\nåœ¨æ¢æµ‹å¤±è´¥æ—¶ï¼Œè®°å½•è¯¦ç»†çš„ HTTP å“åº”ï¼š\n\n```python\n# è®°å½• HTTP çŠ¶æ€ç ã€å“åº”å¤´ç­‰\nprint(f\"Status: {response.status}\")\nprint(f\"Headers: {response.headers}\")\nprint(f\"Cookies: {session.cookie_jar}\")\n```\n\n---\n\n## ğŸ“ ç‰ˆæœ¬æ›´æ–°æ—¥å¿—\n\n### v1.1 (2025-12-29)\n\n**æ–°å¢**ï¼š\n- âœ… æ·»åŠ ç™»å½•å‰çš„ Session åˆå§‹åŒ–é€»è¾‘\n- âœ… æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨è®¿é—®æµç¨‹\n- âœ… è‡ªåŠ¨è·Ÿéš 302 é‡å®šå‘\n\n**ä¿®å¤**ï¼š\n- âœ… ä¿®å¤éƒ¨åˆ† OpenWrt è®¾å¤‡ç™»å½•å¤±è´¥çš„é—®é¢˜\n- âœ… ä¿®å¤ç¼ºå°‘ Session Cookie å¯¼è‡´çš„ 401 é”™è¯¯\n\n**å…¼å®¹æ€§**ï¼š\n- âœ… å®Œå…¨å‘åå…¼å®¹è€ç‰ˆ OpenWrt\n- âœ… æå‡æ–°ç‰ˆ LuCI çš„æˆåŠŸç‡\n\n---\n\n## ğŸ¯ ç»“è®º\n\næ‚¨çš„è§‚å¯Ÿ**éå¸¸å‡†ç¡®**ï¼è¿™ä¸ª\"è·³è½¬å’Œç­‰å¾…\"çš„ç»†èŠ‚ç¡®å®å½±å“äº†ç¨‹åºçš„æˆåŠŸç‡ã€‚\n\n**ä¼˜åŒ–åçš„æ•ˆæœ**ï¼š\n- âœ… æ›´æ¥è¿‘çœŸå®æµè§ˆå™¨è¡Œä¸º\n- âœ… æé«˜ç™»å½•æˆåŠŸç‡\n- âœ… è§£å†³ Session åˆå§‹åŒ–é—®é¢˜\n- âœ… ä¸ºåç»­æ”¯æŒ CSRF Token æ‰“ä¸‹åŸºç¡€\n\n**å»ºè®®æµ‹è¯•**ï¼š\n1. é‡æ–°è¿è¡Œç¨‹åºï¼š`python openwrt_manager.py`\n2. ä½¿ç”¨ç›¸åŒçš„ 4 ä¸ªåœ°å€å†æ¬¡æµ‹è¯•\n3. è§‚å¯ŸæˆåŠŸç‡æ˜¯å¦æå‡\n\nå¦‚æœ**ä»ç„¶å…¨éƒ¨å¤±è´¥**ï¼Œå¯èƒ½éœ€è¦ï¼š\n- æ£€æŸ¥å¯†ç æ˜¯å¦çœŸçš„éƒ½è¢«ä¿®æ”¹äº†\n- æˆ–è€…æ·»åŠ  CSRF Token æ”¯æŒï¼ˆé’ˆå¯¹æ–°ç‰ˆ LuCIï¼‰\n"}, {"path": "macos_widgets.py", "content": "#!/usr/bin/env python3\n# -*- coding: utf-8 -*-\n\"\"\"\nmacOSé£æ ¼çª—å£ç»„ä»¶\nåŒ…å«æ ‡é¢˜æ ã€èœå•æ ç­‰macOSç‰¹æœ‰å…ƒç´ \n\"\"\"\n\nfrom PyQt6.QtWidgets import (QWidget, QVBoxLayout, QHBoxLayout, QLabel, \n                             QPushButton, QFrame, QMenu)\nfrom PyQt6.QtCore import Qt, pyqtSignal\nfrom PyQt6.QtGui import QLinearGradient, QPalette, QPainter, QColor\nfrom design_system import Colors, Spacing, Typography\n\nclass MacTitleBar(QWidget):\n    \"\"\"macOSæ ‡é¢˜æ  - å¸¦æ¸å˜å’Œçº¢ç»¿ç¯æŒ‰é’®\"\"\"\n    closeClicked = pyqtSignal()\n    minimizeClicked = pyqtSignal()\n    maximizeClicked = pyqtSignal()\n    \n    def __init__(self, title=\"\", version=\"\", parent=None):\n        super().__init__(parent)\n        self.setFixedHeight(Spacing.TITLEBAR_HEIGHT)\n        self.setup_ui(title, version)\n        \n    def setup_ui(self, title, version):\n        c = Colors.Light\n        layout = QHBoxLayout(self)\n        layout.setContentsMargins(16, 0, 16, 0)\n        layout.setSpacing(0)\n        \n        # çº¢ç»¿ç¯æŒ‰é’®ç»„\n        traffic_lights = QWidget()\n        traffic_layout = QHBoxLayout(traffic_lights)\n        traffic_layout.setContentsMargins(0, 0, 0, 0)\n        traffic_layout.setSpacing(8)\n        \n        # çº¢è‰²æŒ‰é’®\n        red_btn = QPushButton()\n        red_btn.setFixedSize(12, 12)\n        red_btn.setStyleSheet(f\"\"\"\n            QPushButton {{\n                background-color: {c.TRAFFIC_RED.name()};\n                border: 1px solid {c.TRAFFIC_RED_BORDER.name()};\n                border-radius: 6px;\n            }}\n            QPushButton:hover {{\n                filter: brightness(0.9);\n            }}\n        \"\"\")\n        red_btn.clicked.connect(self.closeClicked.emit)\n        traffic_layout.addWidget(red_btn)\n        \n        # é»„è‰²æŒ‰é’®\n        yellow_btn = QPushButton()\n        yellow_btn.setFixedSize(12, 12)\n        yellow_btn.setStyleSheet(f\"\"\"\n            QPushButton {{\n                background-color: {c.TRAFFIC_YELLOW.name()};\n                border: 1px solid {c.TRAFFIC_YELLOW_BORDER.name()};\n                border-radius: 6px;\n            }}\n            QPushButton:hover {{\n                filter: brightness(0.9);\n            }}\n        \"\"\")\n        yellow_btn.clicked.connect(self.minimizeClicked.emit)\n        traffic_layout.addWidget(yellow_btn)\n        \n        # ç»¿è‰²æŒ‰é’®\n        green_btn = QPushButton()\n        green_btn.setFixedSize(12, 12)\n        green_btn.setStyleSheet(f\"\"\"\n            QPushButton {{\n                background-color: {c.TRAFFIC_GREEN.name()};\n                border: 1px solid {c.TRAFFIC_GREEN_BORDER.name()};\n                border-radius: 6px;\n            }}\n            QPushButton:hover {{\n                filter: brightness(0.9);\n            }}\n        \"\"\")\n        green_btn.clicked.connect(self.maximizeClicked.emit)\n        traffic_layout.addWidget(green_btn)\n        \n        layout.addWidget(traffic_lights)\n        layout.addStretch()\n        \n        # æ ‡é¢˜ï¼ˆå±…ä¸­ï¼‰\n        title_container = QWidget()\n        title_layout = QHBoxLayout(title_container)\n        title_layout.setContentsMargins(0, 0, 0, 0)\n        title_layout.setSpacing(8)\n        \n        title_label = QLabel(title)\n        title_label.setStyleSheet(f\"\"\"\n            color: {c.TEXT_TITLE.name()};\n            font-size: 13px;\n            font-weight: 500;\n            background-color: transparent;\n        \"\"\")\n        title_layout.addWidget(title_label)\n        \n        version_label = QLabel(version)\n        version_label.setStyleSheet(f\"\"\"\n            color: {c.TEXT_VERSION.name()};\n            font-size: 11px;\n            background-color: transparent;\n        \"\"\")\n        title_layout.addWidget(version_label)\n        \n        layout.addWidget(title_container)\n        layout.addStretch()\n        \n    def paintEvent(self, event):\n        \"\"\"ç»˜åˆ¶æ¸å˜èƒŒæ™¯\"\"\"\n        painter = QPainter(self)\n        painter.setRenderHint(QPainter.RenderHint.Antialiasing)\n        \n        gradient = QLinearGradient(0, 0, 0, self.height())\n        gradient.setColorAt(0, Colors.Light.BG_TITLEBAR_TOP)\n        gradient.setColorAt(1, Colors.Light.BG_TITLEBAR_BOTTOM)\n        \n        painter.fillRect(self.rect(), gradient)\n        \n        # åº•éƒ¨è¾¹æ¡†\n        painter.setPen(Colors.Light.BORDER_MENUBAR)\n        painter.drawLine(0, self.height()-1, self.width(), self.height()-1)\n\nclass MacMenuBar(QWidget):\n    \"\"\"macOSèœå•æ \"\"\"\n    def __init__(self, parent=None):\n        super().__init__(parent)\n        self.setFixedHeight(Spacing.MENUBAR_HEIGHT)\n        self.setup_ui()\n        \n    def setup_ui(self):\n        c = Colors.Light\n        layout = QHBoxLayout(self)\n        layout.setContentsMargins(12, 0, 12, 0)\n        layout.setSpacing(0)\n        \n        # å ä½ç¬¦å°†èœå•æ¨åˆ°å³ä¾§\n        layout.addStretch()\n        \n        # èœå•é¡¹\n        menu_items = [\n            (\"OpenWrt Manager\", True),  # (åç§°, æ˜¯å¦ç²—ä½“)\n            (\"æ–‡ä»¶\", False),\n            (\"ç¼–è¾‘\", False),\n            (\"è§†å›¾\", False),\n            (\"æ‰«æ\", False),\n            (\"çª—å£\", False),\n            (\"å¸®åŠ©\", False),\n        ]\n        \n        for menu_name, is_bold in menu_items:\n            btn = QPushButton(menu_name)\n            # æ·»åŠ èœå• (å³ä½¿æ˜¯ç©ºçš„ï¼Œä¸ºäº†è§†è§‰æ•ˆæœ)\n            menu = QMenu(self)\n            if menu_name == \"æ–‡ä»¶\":\n                 menu.addAction(\"æ–°å»º\")\n                 menu.addAction(\"æ‰“å¼€...\")\n                 menu.addSeparator()\n                 menu.addAction(\"å¯¼å‡º\")\n            elif menu_name == \"ç¼–è¾‘\":\n                 menu.addAction(\"æ’¤é”€\")\n                 menu.addAction(\"é‡åš\")\n                 menu.addSeparator()\n                 menu.addAction(\"å‰ªåˆ‡\")\n                 menu.addAction(\"å¤åˆ¶\")\n                 menu.addAction(\"ç²˜è´´\")\n            else:\n                 menu.addAction(\"ç¤ºä¾‹é€‰é¡¹ 1\")\n                 menu.addAction(\"ç¤ºä¾‹é€‰é¡¹ 2\")\n            \n            btn.setMenu(menu)\n            \n            if is_bold:\n                btn.setStyleSheet(f\"\"\"\n                    QPushButton {{\n                        background-color: transparent;\n                        color: {c.TEXT_PRIMARY.name()};\n                        border: none;\n                        border-radius: 4px;\n                        padding: 2px 10px;\n                        font-family: {Typography.FONT_FAMILY_SANS};\n                        font-size: 13px;\n                        font-weight: 600;\n                    }}\n                    QPushButton:hover {{\n                        background-color: rgba(0,0,0,0.05);\n                    }}\n                    QPushButton::menu-indicator {{ width: 0px; }}\n                \"\"\")\n            else:\n                btn.setStyleSheet(f\"\"\"\n                    QPushButton {{\n                        background-color: transparent;\n                        color: {c.TEXT_PRIMARY.name()};\n                        border: none;\n                        border-radius: 4px;\n                        padding: 2px 10px;\n                        font-family: {Typography.FONT_FAMILY_SANS};\n                        font-size: 13px;\n                    }}\n                    QPushButton:hover {{\n                        background-color: rgba(0,0,0,0.05);\n                    }}\n                    QPushButton::menu-indicator {{ width: 0px; }}\n                \"\"\")\n            layout.addWidget(btn)\n        \n        # ç§»é™¤æ—¶é—´æ˜¾ç¤º\n        # time_label = QLabel(\"15:00\")\n        \n    def paintEvent(self, event):\n        \"\"\"ç»˜åˆ¶æ¸å˜èƒŒæ™¯\"\"\"\n        painter = QPainter(self)\n        painter.setRenderHint(QPainter.RenderHint.Antialiasing)\n        \n        gradient = QLinearGradient(0, 0, 0, self.height())\n        gradient.setColorAt(0, Colors.Light.BG_MENUBAR_TOP)\n        gradient.setColorAt(1, Colors.Light.BG_MENUBAR_BOTTOM)\n        \n        painter.fillRect(self.rect(), gradient)\n        \n        # åº•éƒ¨è¾¹æ¡†\n        painter.setPen(Colors.Light.BORDER_PRIMARY)\n        painter.drawLine(0, self.height()-1, self.width(), self.height()-1)\n\nclass MacWindow(QWidget):\n    \"\"\"macOSé£æ ¼çš„çª—å£å®¹å™¨ - å¸¦åœ†è§’è¾¹æ¡†\"\"\"\n    def __init__(self, parent=None):\n        super().__init__(parent)\n        self.setStyleSheet(f\"\"\"\n            MacWindow {{\n                background-color: {Colors.Light.BG_SECONDARY.name()};\n                border: 1px solid {Colors.Light.BORDER_PRIMARY.name()};\n                border-radius: 10px;\n            }}\n        \"\"\")\n"}]