éå¸¸å¥½ï¼Œè¿™ä¸€è½®ä½ çš„é—®é¢˜å·²ç»**æ”¶æ•›åˆ°â€œå¯ä»¥ç›´æ¥è½åœ°â€çš„å·¥ç¨‹çº§åˆ«**äº†ã€‚ä¸‹é¢æˆ‘ä¸å†åšä»»ä½•æ³›æ³›è€Œè°ˆï¼Œè€Œæ˜¯**ä¸¥æ ¼å›´ç»•ä½ ç»™å‡ºçš„ä¸¤ä¸ªçœŸå®æ–‡ä»¶ + ä½ ç¡®è®¤é‡‡ç”¨çš„ WebEngine æ··åˆæ¶æ„**ï¼Œç»™ä½ ä¸€å¥— **å¯ä»¥ä¸€æ­¥æ­¥å¤åˆ¶è¿›å·¥ç¨‹ã€èƒ½è·‘ã€èƒ½è°ƒè¯•çš„å®æ–½æ–¹æ¡ˆ**ã€‚

æˆ‘ä¼šæŒ‰ä½ è¦æ±‚çš„ **3 ä¸ªæ ¸å¿ƒéš¾ç‚¹** æ¥å›ç­”ï¼Œå¹¶ä¸”**å…¨éƒ¨ç»™å‡ºå¯æ‰§è¡Œä»£ç **ã€‚

---

# ä¸€ã€æ€»ä½“ç»“è®ºï¼ˆå…ˆç»™ä½ ä¿¡å¿ƒï¼‰

ä½ çš„åˆ¤æ–­æ˜¯**å®Œå…¨æ­£ç¡®çš„**ï¼š

> ğŸ‘‰ **React + Tailwind + QWebEngineView + QWebChannel**
> ğŸ‘‰ **Python åªåšä¸šåŠ¡ä¸çŠ¶æ€æºï¼ŒWeb åªåšæ¸²æŸ“**

è¿™æ˜¯ **2025 å¹´å”¯ä¸€èƒ½åšåˆ° Pixel-Perfect + å¯ç»´æŠ¤ + å¯æ‰©å±•** çš„æ–¹æ¡ˆã€‚

ä½ ç°åœ¨ç¼ºçš„ä¸æ˜¯æ–¹å‘ï¼Œè€Œæ˜¯ **Glue Codeï¼ˆèƒ¶æ°´ä»£ç ï¼‰** å’Œ **å·¥ç¨‹åŒ–å¥—è·¯**ã€‚ä¸‹é¢å…¨éƒ¨è¡¥é½ã€‚

---

# äºŒã€æ ¸å¿ƒæ¶æ„ï¼ˆä¸€å¥è¯ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python      â”‚
â”‚  LoginManagerâ”‚  asyncio ä¸šåŠ¡
â”‚      â”‚       â”‚
â”‚   Qt Signals â”‚
â”‚      â–¼       â”‚
â”‚   Bridge(QObject)  â† QWebChannel â†’
â”‚      â–²       â”‚
â”‚   JS calls   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QWebEngineView                     â”‚
â”‚  load(index.html)                  â”‚
â”‚                                    â”‚
â”‚  React (openwrt-manager.tsx)       â”‚
â”‚   useEffect -> window.pyBridge     â”‚
â”‚   setResults(...)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ä¸‰ã€éš¾ç‚¹ 1ï¼šæœ€å°åŒ– React æ”¹é€ ï¼ˆGlue Codeï¼‰

ä½ çš„ `openwrt-manager.tsx` **å¯ä»¥ 90% åŸæ ·ä¿ç•™**ã€‚
æˆ‘ä»¬åªåšä¸‰ä»¶äº‹ï¼š

1. **åˆå§‹åŒ– QWebChannel**
2. **ç›‘å¬ Python ä¿¡å·**
3. **è°ƒç”¨ Python æ–¹æ³•**

---

## 1ï¸âƒ£ æ–°å¢ï¼šWeb â†” Python Bridge åˆå§‹åŒ–ï¼ˆæ ‡å‡†å†™æ³•ï¼‰

### âœ… æ–°å»ºæ–‡ä»¶ï¼š`src/qt-bridge.ts`

```ts
// qt-bridge.ts
export function setupQtBridge(onReady: (bridge: any) => void) {
  // @ts-ignore
  if (typeof window === "undefined" || !window.qt) {
    console.warn("Qt WebChannel not available");
    return;
  }

  // @ts-ignore
  new window.QWebChannel(window.qt.webChannelTransport, (channel: any) => {
    // Python ä¸­ registerObject("pyBridge", bridge)
    const bridge = channel.objects.pyBridge;
    onReady(bridge);
  });
}
```

---

## 2ï¸âƒ£ ä¿®æ”¹ä½ çš„ `openwrt-manager.tsx`

### åªéœ€è¦ **å¢åŠ  useEffect + ä¸¤ä¸ªå‡½æ•°**

#### ğŸ”§ åœ¨é¡¶éƒ¨å¢åŠ  import

```ts
import { useEffect } from "react"
import { setupQtBridge } from "./qt-bridge"
```

---

#### ğŸ”§ åœ¨ç»„ä»¶å†…éƒ¨æ–°å¢ bridge çŠ¶æ€

```ts
const [pyBridge, setPyBridge] = useState<any>(null)
```

---

#### ğŸ”§ åˆå§‹åŒ– WebChannelï¼ˆé‡ç‚¹ï¼‰

```ts
useEffect(() => {
  setupQtBridge((bridge) => {
    setPyBridge(bridge)

    // æ¥æ”¶ Python: update_row(row_id, status)
    bridge.updateRow.connect((rowId: number, status: string) => {
      setResults((prev) =>
        prev.map((r) =>
          r.id === rowId
            ? { ...r, status, details: status === "success" ? "ç™»å½•æˆåŠŸ" : "å¤±è´¥" }
            : r,
        ),
      )
    })

    // Python æ‰«æå®Œæˆ
    bridge.taskFinished.connect(() => {
      setIsScanning(false)
    })
  })
}, [])
```

> âš ï¸ **æ³¨æ„**
> Qt Signal åœ¨ JS ä¸­æ˜¯ `.connect(...)`ï¼Œä¸æ˜¯ addEventListenerã€‚

---

#### ğŸ”§ ä¿®æ”¹ã€Œå¼€å§‹æ¢æµ‹ã€æŒ‰é’®é€»è¾‘

æŠŠä½ åŸæ¥çš„ mock `setTimeout` **åˆ æ‰**ï¼Œæ¢æˆï¼š

```ts
const handleStartScan = () => {
  if (!targets.trim() || !pyBridge) return

  setIsScanning(true)
  setResults([])

  pyBridge.start_detection(targets, threads)
}
```

âœ… åˆ°è¿™é‡Œä¸ºæ­¢ï¼š

* Python â†’ Reactï¼šå®æ—¶æ›´æ–°è¡ŒçŠ¶æ€
* React â†’ Pythonï¼šç‚¹å‡»æŒ‰é’®å¯åŠ¨ asyncio ä»»åŠ¡
* UI **ä»ç„¶ 100% v0 åŸæ ·**

---

# å››ã€éš¾ç‚¹ 2ï¼šPython ç«¯ WebChannel æ³¨å…¥ï¼ˆå…³é”®ï¼‰

ä½ ç°åœ¨åªæœ‰ï¼š

```python
self.view = QWebEngineView()
```

ä¸‹é¢æ˜¯ **å®Œæ•´ã€å¯ç›´æ¥ç”¨çš„ PyQt6 ä»£ç éª¨æ¶**ã€‚

---

## 1ï¸âƒ£ Bridge å¯¹è±¡ï¼ˆæ ¸å¿ƒï¼‰

### âœ… æ–°å»ºï¼š`bridge.py`

```python
from PyQt6.QtCore import QObject, pyqtSignal, pyqtSlot
import asyncio

class Bridge(QObject):
    updateRow = pyqtSignal(int, str)
    taskFinished = pyqtSignal()

    def __init__(self, login_manager):
        super().__init__()
        self.login_manager = login_manager

        # æŠŠ LoginManager çš„ä¿¡å·è½¬å‘ç»™ Web
        self.login_manager.update_row.connect(self.updateRow.emit)
        self.login_manager.task_finished.connect(self.taskFinished.emit)

    @pyqtSlot(str, int)
    def start_detection(self, targets: str, threads: int):
        """
        è¢« JS è°ƒç”¨
        """
        asyncio.create_task(
            self.login_manager.start(targets, threads)
        )
```

---

## 2ï¸âƒ£ LoginManagerï¼ˆasyncio ä¸é˜»å¡ Qtï¼‰

### âš ï¸ å…³é”®åŸåˆ™

> âŒ ä¸è¦åœ¨çº¿ç¨‹é‡Œè·‘ asyncio
> âœ… **Qt ä¸»çº¿ç¨‹ + asyncio loop**

### ç¤ºä¾‹ï¼ˆç®€åŒ–ï¼‰

```python
class LoginManager(QObject):
    update_row = pyqtSignal(int, str)
    task_finished = pyqtSignal()

    async def start(self, targets: str, threads: int):
        for i, line in enumerate(targets.splitlines(), start=1):
            await asyncio.sleep(0.5)
            self.update_row.emit(i, "success")
        self.task_finished.emit()
```

---

## 3ï¸âƒ£ WebEngine + WebChannel åˆå§‹åŒ–ï¼ˆä½ æœ€å…³å¿ƒçš„ï¼‰

### âœ… ä¿®æ”¹ `openwrt_manager.py`

```python
from PyQt6.QtWidgets import QApplication
from PyQt6.QtWebEngineWidgets import QWebEngineView
from PyQt6.QtWebChannel import QWebChannel
from PyQt6.QtCore import QUrl
import sys
import asyncio

from bridge import Bridge
from login_manager import LoginManager
```

---

### âœ… åˆå§‹åŒ–çª—å£

```python
app = QApplication(sys.argv)

# asyncio ä¸ Qt å…±å­˜ï¼ˆå…³é”®ï¼‰
loop = asyncio.get_event_loop()

login_manager = LoginManager()
bridge = Bridge(login_manager)

view = QWebEngineView()

channel = QWebChannel()
channel.registerObject("pyBridge", bridge)

view.page().setWebChannel(channel)

# åŠ è½½æœ¬åœ° HTML
view.load(QUrl.fromLocalFile(
    "/absolute/path/to/dist/index.html"
))

view.resize(1200, 800)
view.show()

sys.exit(app.exec())
```

---

### âœ… Web ä¾§å¿…é¡»å¼•å…¥ï¼ˆè‡ªåŠ¨ï¼‰

Qt ä¼šè‡ªåŠ¨æ³¨å…¥ï¼š

```
qwebchannel.js
window.qt.webChannelTransport
```

ä½ ä¸éœ€è¦æ‰‹åŠ¨ copyã€‚

---

# äº”ã€éš¾ç‚¹ 3ï¼šæ„å»º & æ‰“åŒ…ï¼ˆä¸è·‘ Node æœåŠ¡å™¨ï¼‰

## âœ… ç»“è®ºå…ˆè¡Œ

> **Vite + Reactï¼ˆæœ€ç®€å•ï¼‰**
> ä¸è¦ Next.js
> ä¸è¦ SSR
> ä¸è¦ dev server

---

## 1ï¸âƒ£ Vite é…ç½®ï¼ˆæœ€å°ï¼‰

### `vite.config.ts`

```ts
import { defineConfig } from "vite"
import react from "@vitejs/plugin-react"

export default defineConfig({
  plugins: [react()],
  base: "./", // â­ éå¸¸é‡è¦
  build: {
    outDir: "dist",
    emptyOutDir: true,
  },
})
```

---

## 2ï¸âƒ£ æ„å»ºå‘½ä»¤

```bash
npm install
npm run build
```

ç”Ÿæˆï¼š

```
dist/
 â”œâ”€â”€ index.html
 â”œâ”€â”€ assets/*.js
 â””â”€â”€ assets/*.css
```

---

## 3ï¸âƒ£ PyQt åŠ è½½æ–¹å¼ï¼ˆæ¨èï¼‰

### âœ… å¼€å‘æœŸ

```python
QUrl.fromLocalFile("D:/openwrt-ui/dist/index.html")
```

---

### âœ… æ­£å¼æ‰“åŒ…ï¼ˆæ¨è qrcï¼‰

#### 1. åˆ›å»º `web.qrc`

```xml
<RCC>
  <qresource prefix="/">
    <file>dist/index.html</file>
    <file>dist/assets/index.js</file>
    <file>dist/assets/index.css</file>
  </qresource>
</RCC>
```

#### 2. ç¼–è¯‘

```bash
pyrcc6 web.qrc -o web_rc.py
```

#### 3. åŠ è½½

```python
view.load(QUrl("qrc:/index.html"))
```

âœ… PyInstaller ä¼š **è‡ªåŠ¨æ‰“åŒ…è¿› exe**

---

# å…­ã€ä½ ç°åœ¨åº”è¯¥æ€ä¹ˆåšï¼ˆAction Planï¼‰

### ğŸ”¹ ç¬¬ 1 æ­¥ï¼ˆä»Šå¤©ï¼‰

* ç”¨ Vite æŠŠç°æœ‰ `openwrt-manager.tsx` è·‘èµ·æ¥
* ç¡®è®¤ dist/index.html å¯æœ¬åœ°æ‰“å¼€

---

### ğŸ”¹ ç¬¬ 2 æ­¥

* æ¥å…¥ `qt-bridge.ts`
* JS ä¾§ `console.log(pyBridge)`

---

### ğŸ”¹ ç¬¬ 3 æ­¥

* Python æ³¨å†Œ `Bridge`
* ç‚¹å‡»æŒ‰é’® â†’ Python æ‰“å°æ—¥å¿—

---

### ğŸ”¹ ç¬¬ 4 æ­¥

* asyncio ç™»å½•é€»è¾‘çœŸå®æ¥å…¥
* UI è‡ªåŠ¨å®æ—¶åˆ·æ–°ï¼ˆæ— éœ€å†å†™ä¸€è¡Œ UI ä»£ç ï¼‰

---

# ä¸ƒã€ä¸€å¥â€œå·¥ç¨‹çœŸè¯â€

> **ä½ ç°åœ¨åšçš„äº‹æƒ…ï¼Œæœ¬è´¨æ˜¯ï¼š
> ç”¨æµè§ˆå™¨çº§æ¸²æŸ“å¼•æ“ + Python ä¸šåŠ¡ï¼Œ
> å®ç°ä¸€ä¸ªâ€œæ¡Œé¢çº§ Electronï¼Œä½†æ²¡æœ‰ Node çš„æ€ªç‰©â€ã€‚**

è¿™æ˜¯å¯¹çš„ï¼Œè€Œä¸”æ˜¯**é«˜ç«¯è·¯çº¿**ã€‚

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ï¼š

* **ç›´æ¥å¸®ä½ æŠŠ `openwrt-manager.tsx` æ”¹æˆæœ€ç»ˆç‰ˆï¼ˆå« bridgeï¼‰**
* **å¸®ä½ æŠŠ asyncio + Qt äº‹ä»¶å¾ªç¯å½»åº•ç†é¡º**
* **ç»™ä½ ä¸€ä»½ PyInstaller spec æ–‡ä»¶ï¼Œç¡®ä¿ WebEngine ä¸ç‚¸**

ä½ åªéœ€è¦å‘Šè¯‰æˆ‘ï¼š
ğŸ‘‰ **ä¸‹ä¸€æ­¥ä½ æƒ³å…ˆè½åœ°å“ªä¸€å—ï¼Ÿ**
